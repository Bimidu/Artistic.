<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASD Detection System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .section h2 {
            color: #444;
            margin-top: 0;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .loading {
            color: #666;
            font-style: italic;
        }
        
        .feature-list {
            max-height: 300px;
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }
        
        .feature-item {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .feature-item:last-child {
            border-bottom: none;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-implemented {
            background-color: #28a745;
        }
        
        .status-placeholder {
            background-color: #ffc107;
        }
        
        .api-url {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .info-tip {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
            color: #0066cc;
        }
        
        .info-tip strong {
            color: #004499;
        }
        
        .tip-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-color: #0066cc;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            margin-right: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ASD Detection System</h1>
        
        <div class="info-tip">
            <span class="tip-icon">i</span>
            <strong>Getting Started:</strong> This interface allows you to interact with the ASD Detection System API. First, ensure the API server is running (python run_api.py), then test the connection. You can make predictions on child speech transcripts, explore available features, check system status, and view trained models.
        </div>
        
        <!-- API Configuration -->
        <div class="section">
            <h2>API Configuration</h2>
            <div class="info-tip">
                <span class="tip-icon">i</span>
                <strong>Tip:</strong> Make sure the API server is running before testing the connection. The default URL assumes you're running the API on localhost port 8000. If your API is running on a different address or port, update the URL accordingly.
            </div>
            <div class="form-group">
                <label for="apiUrl">API Base URL:</label>
                <input type="text" id="apiUrl" value="http://localhost:8000" placeholder="http://localhost:8000">
            </div>
            <button onclick="testConnection()">Test Connection</button>
            <div id="connectionResult"></div>
        </div>
        
        <!-- Prediction -->
        <div class="section">
            <h2>Make Prediction</h2>
            <div class="info-tip">
                <span class="tip-icon">i</span>
                <strong>Tip:</strong> Enter a conversation transcript from a child to get an ASD/TD prediction. The system analyzes pragmatic and conversational features. Example: "hello there how are you doing today". Different models may give slightly different results - try multiple models for comparison.
            </div>
            <div class="form-group">
                <label for="participantId">Participant ID:</label>
                <input type="text" id="participantId" placeholder="ASD_001">
            </div>
            <div class="form-group">
                <label for="transcript">Transcript:</label>
                <textarea id="transcript" placeholder="Enter conversation transcript here..."></textarea>
            </div>
            <div class="form-group">
                <label for="modelType">Model Type:</label>
                <select id="modelType">
                    <option value="random_forest">Random Forest</option>
                    <option value="xgboost">XGBoost</option>
                    <option value="lightgbm">LightGBM</option>
                    <option value="svm">SVM</option>
                    <option value="logistic">Logistic Regression</option>
                </select>
            </div>
            <button onclick="makePrediction()">Make Prediction</button>
            <div id="predictionResult"></div>
        </div>
        
        <!-- Features -->
        <div class="section">
            <h2>Available Features</h2>
            <div class="info-tip">
                <span class="tip-icon">i</span>
                <strong>Tip:</strong> This shows all 61 pragmatic and conversational features that the system can extract from transcripts. These include turn-taking patterns, linguistic complexity measures, pragmatic markers, and conversational management features. The features are used to train the machine learning models.
            </div>
            <button onclick="loadFeatures()">Load Features</button>
            <div id="featuresResult"></div>
        </div>
        
        <!-- Categories -->
        <div class="section">
            <h2>Feature Categories</h2>
            <div class="info-tip">
                <span class="tip-icon">i</span>
                <strong>Tip:</strong> The system is designed for three types of features. Green dots indicate implemented components, yellow dots show placeholders ready for team development. Currently, only pragmatic/conversational features are fully implemented and production-ready.
            </div>
            <button onclick="loadCategories()">Load Categories</button>
            <div id="categoriesResult"></div>
        </div>
        
        <!-- Models -->
        <div class="section">
            <h2>Available Models</h2>
            <div class="info-tip">
                <span class="tip-icon">i</span>
                <strong>Tip:</strong> This shows all trained machine learning models available for predictions. If no models appear, you need to train them first using the training scripts. Each model uses different algorithms and may perform differently on various types of speech patterns.
            </div>
            <button onclick="loadModels()">Load Models</button>
            <div id="modelsResult"></div>
        </div>
    </div>

    <script>
        function getApiUrl() {
            return document.getElementById('apiUrl').value.replace(/\/$/, '');
        }
        
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${content}</div>`;
        }
        
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div class="result loading">Loading...</div>';
        }
        
        async function testConnection() {
            showLoading('connectionResult');
            
            try {
                const response = await fetch(`${getApiUrl()}/health`);
                if (response.ok) {
                    showResult('connectionResult', 'Connection successful! API is running.', 'success');
                } else {
                    showResult('connectionResult', `Connection failed. Status: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult('connectionResult', `Connection error: ${error.message}`, 'error');
            }
        }
        
        async function makePrediction() {
            const participantId = document.getElementById('participantId').value;
            const transcript = document.getElementById('transcript').value;
            const modelType = document.getElementById('modelType').value;
            
            if (!participantId || !transcript) {
                showResult('predictionResult', 'Please fill in Participant ID and Transcript.', 'error');
                return;
            }
            
            showLoading('predictionResult');
            
            try {
                const response = await fetch(`${getApiUrl()}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        participant_id: participantId,
                        transcript: transcript,
                        model_type: modelType
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const result = `Prediction: ${data.prediction}\nConfidence: ${(data.confidence * 100).toFixed(2)}%\nModel: ${data.model_type}\nFeatures used: ${data.features_count}`;
                    showResult('predictionResult', result, 'success');
                } else {
                    showResult('predictionResult', `Error: ${data.detail || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('predictionResult', `Request error: ${error.message}`, 'error');
            }
        }
        
        async function loadFeatures() {
            showLoading('featuresResult');
            
            try {
                const response = await fetch(`${getApiUrl()}/features`);
                const data = await response.json();
                
                if (response.ok) {
                    let html = `<h3>Total Features: ${data.count}</h3>`;
                    html += '<div class="feature-list">';
                    
                    data.features.forEach(feature => {
                        html += `<div class="feature-item">${feature}</div>`;
                    });
                    
                    html += '</div>';
                    
                    document.getElementById('featuresResult').innerHTML = html;
                } else {
                    showResult('featuresResult', `Error: ${data.detail || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('featuresResult', `Request error: ${error.message}`, 'error');
            }
        }
        
        async function loadCategories() {
            showLoading('categoriesResult');
            
            try {
                const response = await fetch(`${getApiUrl()}/categories`);
                const data = await response.json();
                
                if (response.ok) {
                    let html = '<h3>Feature Categories Status:</h3>';
                    
                    Object.entries(data.categories).forEach(([key, category]) => {
                        const statusClass = category.status === 'implemented' ? 'status-implemented' : 'status-placeholder';
                        const statusText = category.status === 'implemented' ? 'Implemented' : 'Placeholder';
                        
                        html += `
                            <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <h4><span class="status-indicator ${statusClass}"></span>${category.name}</h4>
                                <p><strong>Status:</strong> ${statusText}</p>
                                <p><strong>Team:</strong> ${category.team}</p>
                                <p><strong>Description:</strong> ${category.description}</p>
                                <p><strong>Examples:</strong> ${category.examples.join(', ')}</p>
                            </div>
                        `;
                    });
                    
                    document.getElementById('categoriesResult').innerHTML = html;
                } else {
                    showResult('categoriesResult', `Error: ${data.detail || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('categoriesResult', `Request error: ${error.message}`, 'error');
            }
        }
        
        async function loadModels() {
            showLoading('modelsResult');
            
            try {
                const response = await fetch(`${getApiUrl()}/models`);
                const data = await response.json();
                
                if (response.ok) {
                    let html = '<h3>Available Models:</h3>';
                    
                    if (data.models && data.models.length > 0) {
                        data.models.forEach(model => {
                            html += `
                                <div style="margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                    <strong>${model.name}</strong><br>
                                    Type: ${model.type}<br>
                                    Status: ${model.status}<br>
                                    Features: ${model.features_count}
                                </div>
                            `;
                        });
                    } else {
                        html += '<p>No models available. Train models first using the API.</p>';
                    }
                    
                    document.getElementById('modelsResult').innerHTML = html;
                } else {
                    showResult('modelsResult', `Error: ${data.detail || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('modelsResult', `Request error: ${error.message}`, 'error');
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Test connection on page load
            setTimeout(testConnection, 500);
        });
    </script>
</body>
</html>
